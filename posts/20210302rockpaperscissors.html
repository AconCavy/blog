<!DOCTYPE html><html lang="ja"><head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline';
img-src 'self' * data: *.w3.org; 
child-src 'none';
frame-src 'self' *.twitter.com;
font-src 'self' *.fontawesome.com;
connect-src 'self' *.fontawesome.com *.typekit.net;
style-src 'self' 'unsafe-inline';
script-src 'self' 'unsafe-eval' *.twitter.com *.typekit.net;">

    <link rel="icon" href="/blog/assets/images/favicon.ico">

    <link href="/blog/mirror/cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/blog/assets/css/style.css" type="text/css">

    <title>acon.log - &#x3058;&#x3083;&#x3093;&#x3051;&#x3093;</title>

    
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="acon.log">
<meta property="og:title" content="&amp;#x3058;&amp;#x3083;&amp;#x3093;&amp;#x3051;&amp;#x3093;">
<meta property="og:description" content="">
<meta property="og:image" content="/blog/assets/images/icon.webp">
<meta property="og:url" content="/blog/posts/20210302rockpaperscissors">


    <script src="/blog/assets/vendor/adobe/adobe_fonts.js"></script>

</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow-sm" id="mainNav">
    <div class="container">
        <a class="navbar-brand" href="/blog/">acon.log</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
    <li class="nav-item">
        <a class="nav-link" href="/blog/posts">Posts</a>
    </li>
</ul>

        </div>
    </div>
</nav>


<header>
</header>


<div class="container">
    <div class="row">
        <div id="content">

                <div class="card shadow-sm">
                    <div class="card-body p-md-5">
                        
<div class="post-header">
    <div class="row">
        <div class="col-md-12">
            <h1 class="card-title">&#x3058;&#x3083;&#x3093;&#x3051;&#x3093;</h1>

            <div class="card-text post-meta">
                Published on Tuesday, 02 March 2021
            </div>
            <div class="card-text post-meta">Updated on Tuesday, 02 March 2021</div>

                <div class="mt-3">
                        <a href="/blog/tags/csharp" class="badge badge-light"> csharp</a>
                </div>
        </div>
    </div>
</div>

<hr>

                        <div class="post-body">
                            <h1 id="section">はじめに</h1>
<p><code>if</code> を使わずにじゃんけんします。
じゃんけんの結果はC#8の機能の <a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/language-reference/operators/switch-expression">switch式</a> を使って受け取ります。</p>
<p>先駆者様</p>
<p><a href="https://qiita.com/tadsan/items/65d91ba6b50535fc8815">https://qiita.com/tadsan/items/65d91ba6b50535fc8815</a></p>
<p><a href="https://qiita.com/libraplanet/items/bcf17c22143dc77f875b">https://qiita.com/libraplanet/items/bcf17c22143dc77f875b</a></p>
<p><a href="https://qiita.com/AconCavy/items/b86b9e835a362795d33f">Qiita</a>とのクロスポストです。</p>
<h1 id="section-1">勝敗判定</h1>
<p>じゃんけんのルールとして、<code>-&gt;</code> の右側が強いものとすると、 <code>Rock</code> -&gt; <code>Paper</code> -&gt; <code>Scissors</code> -&gt; <code>Rock</code> の関係性が成り立ち、3つの手を周期として勝敗が決まります。
ここで、<code>Rock</code> を0、<code>Paper</code> を1、<code>Scissors</code> を2として、関係性をそれぞれ1の距離を持った有効グラフだとすると、自分の手と相手の手の距離が1では負け、距離が2では勝ち、距離が0(3)ではあいこのような表現することができます。</p>
<p><img src="assets/images/rps_dia.webp" class="img-fluid" alt="rps_dia.png"></p>
<p>このことから、<code>相手の手 - 自分の手</code> を計算することで距離を求めることができます。
しかし、自分の手が2で、相手の手が0だった場合、<code>0 - 2 == -2</code>のように、距離が負数になってしまいます。このとき、じゃんけんは3つの手を周期としているため、自分の手や相手の手を3つ移動させたところで手は変わらず、勝敗は変わりません。つまり、距離に3を足したり、3で剰余を取ったとしても勝敗は変わりません。このことから、<code>(相手の手 - 自分の手 + 3) % 3</code> とすることで、距離を0、1、2の3つにすることができ、負数と3以上になることを避けることができます。</p>
<h1 id="section-2">実装</h1>
<p><code>Rps</code> (Rock-Paper-Scissors) クラスに <code>Hand</code> (グー、チョキ、パー) と <code>Result</code> (引き分け、負け、勝ち) の <code>enum</code> を定義することで、<code>Battle</code> 関数の引数と戻り値にそれぞれ意味を持たせます。</p>
<p>C#の <code>enum</code> は、既定値として <code>int</code> の0をとり、要素が増えるにつれて1増えます。そのため、この場合は、 <code>Rock (0)</code>、 <code>Paper (1)</code>、 <code>Scissors (2)</code> のようにそれぞれ値を持つことができます。</p>
<p><code>Battle</code> 関数は、自分の手と相手の手を渡すことで、<code>Result.Draw</code>、 <code>Result.Lose</code>、 <code>Result.Win</code> のいずれかを返します。</p>
<pre><code class="language-csharp line-numbers">public static class Rps
{
    public enum Hand
    {
        Rock,
        Paper,
        Scissors
    }

    public enum Result
    {
        Draw,
        Lose,
        Win
    }

    public static Result Battle(Hand own, Hand opponent)
    {
        var result = ((int)opponent - (int)own + 3) % 3;
        return (Result)result;
    }
}
</code></pre>
<p>呼び出し側では、例に倣ってそれぞれの絵文字を割り当てます。
<code>switch式</code> を使うことで、<code>Battle</code> が返す可能性のあるパターンに、 <code>あいこ</code>、<code>あなたの負け</code>、<code>あなたの勝ち</code> を割り当て、一致した要素を <code>result</code> として受け、自分の手、相手の手と一緒に表示します。 <code>_ =&gt; throw new ArgumentOutOfRangeException()</code> では、対象となる値以外の値として判定された際に該当するアームになります。</p>
<pre><code class="language-csharp line-numbers">public static class Program
{
    public static void Main()
    {
        const string draw = &quot;あいこ&quot;;
        const string lose = &quot;あなたの負け&quot;;
        const string win = &quot;あなたの勝ち&quot;;

        var map = new Dictionary&lt;Rps.Hand, string&gt;
        {
            [Rps.Hand.Rock] = &quot;✊&quot;, [Rps.Hand.Paper] = &quot;🖐&quot;, [Rps.Hand.Scissors] = &quot;✌&quot;
        };

        // var hands = new[] { Rps.Hand.Rock, Rps.Hand.Paper, Rps.Hand.Scissors };
        var hands = Enum.GetValues(typeof(Rps.Hand)).Cast&lt;Rps.Hand&gt;().ToArray();

        foreach (var own in hands)
        foreach (var opponent in hands)
        {
            // Draw, Lose, Winのままなら
            // var result = Rps.Battle(own, opponent).ToString();
            
            var result = Rps.Battle(own, opponent) switch
            {
                Rps.Result.Draw =&gt; draw,
                Rps.Result.Lose =&gt; lose,
                Rps.Result.Win =&gt; win,
                _ =&gt; throw new ArgumentOutOfRangeException()
            };
            Console.WriteLine($&quot;{map[own]} vs {map[opponent]}: {result}&quot;);
        }
    }
}
</code></pre>
<h1 id="section-3">実行結果</h1>
<p><img src="assets/images/rps.webp" class="img-fluid" alt="rps.png"></p>
<p><a href="https://sharplab.io/#v2:C4LgTgrgdgPgAgJgIwFgBQcAMACOSAsA3OlrkgHQAyAllAI7FrpQCGAtgKYDOADiwMYdsAZRZQAJgCMA9gA90Ab3TYVuBAGZlqpWlV61CLfuw7jx/tKhdgZHOLAsA7tgC82AESAhBkAiDIGUGd4xm+hZWNng4ADbSXEJuXoBWDID6DIB2DIAFMYCKDAFGQdgh1rbYjrSuHp5JyYC7SoCGDFlMujkqAG4sYNhsLDwlUBzOACLU/MDUli0AngA8AEo8XOQAEmLiADS2AHzZQaYN+gDa07MLEuST0vwA1gC6Je6AUOTuK3sz84vkAAodHGBXcYC8G4AJu/dsI8Di9hPxqFwuNIwFxvh5ADDk7g2ZgAvoFtgB6DHYZqtAAWiy4XR6OyuCmw+2eRxO5xWlMO4jeHzAdKeDPIYIhUJh2DRyOMuOwBIkRLcAFEoBA2OQAOIcYAANRYEQg3AAFMBRjwONIAGZq+mLACURvIAGEWNYpmzFqs1aaACrSACCYAco3tjH5+l10I4Ajx2DVgukjig2GKwvEXCN3r0vrA/v4geDLWw0h4PEsHCgNkjhNj9QaW22qixOLTia4EAiNjclIAQixgMAIhw1aGoCsM1nurnHdJhMAwLQAOaeuNmQVVmt1ilPJsttsdsPdzPZ/vYLhFYDJyfGEul/SUybcWfkXoOZwuVbYexOJb7nIns+1qjRWK3qIxR9Fo96F9qzfAB1Yob0KWhf3/YwAH1XFvYA8TAUNsG6ZxXVHKUc2AAB5CBcN1SYxFHDgxVkQQeCGSx7SfPQ+T/Us8AATjVAASdwFHaHgdk7C4URxIlOI6Hj1z7YA+JAEwZ1rFF3CNdEGhRb0lL/FTsjgdQyAANjUecuGyQ89A07AcylbAGW9QyzBpM4oO2d5tRZJ9OUhaF9IY1Q1I8lRjNMtgKVfYBLKfS8HyfSgPzshpQKgZT0G9Yy8B008gJsRdW3bBl01XczFnTUTsMLTYn2nQKSjVNVaGAI0ew3GwAFogyqmqw2wABqbB1CNbAAFJOoUnI4AAdiDFLZyNaTgAGujshUlEgA===">sharplabでの実行結果</a></p>

                        </div>
                        <div class="post-footer mt-5">
    <div class="share">
        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" url="/blog/posts/20210302rockpaperscissors" data-size="large">
            Tweet
        </a>
    </div>

    <hr>

    <div class="row justify-content-center m-3 about">
        <div class="col-md-3 mt-3">
            <img class="rounded-circle" src="/blog/assets/images/icon.webp" alt="icon">
        </div>
        <div class="col-md-3 mt-3">
            <div class="col">
                <h5>AconCavy</h5>
                <div class="profile">
                    C#が好きなひきこもり
                </div>
            </div>
            <div class="col">
                <a class="nav-link fab fa-twitter fa-2x" href="https://twitter.com/AconCavy"></a>
                <a class="nav-link fab fa-github fa-2x" href="https://github.com/AconCavy"></a>
            </div>
        </div>
    </div>
</div>

                    </div>
                </div>

        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <p>Copyright &#xA9; 2020-2022 AconCavy</p>
                <ul class="list-inline text-center small">
                        <li class="list-inline-item">
                            <a href="/blog/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                        </li>
                        <li class="list-inline-item">
                            <a href="/blog/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        </li>
                </ul>
            </div>
        </div>
    </div>
</footer>


<script src="/blog/mirror/cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="/blog/mirror/cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
<script src="/blog/mirror/kit.fontawesome.com/defa8b99ee.js"></script>

<script src="/blog/assets/vendor/prism/prism.js"></script>

<script async="" src="/blog/mirror/platform.twitter.com/widgets.js" charset="utf-8"></script>





</body></html>